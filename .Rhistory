library(tidyverse)
user = read.table("./原数据-20210301-20210328/user.txt")
user = read.table("./原数据-20210301-20210328/users.txt", sep = '\t')
View(user)
user = read.table("./原数据-20210301-20210328/users.txt", sep = '\t', col.names=T)
View(user)
user[1,]
user = read.table("./原数据-20210301-20210328/users.txt", sep = '\t',
col.names=c("user_id", "avg_pay_amt", "avg_pay_amt_weekdays",
"avg_pay_amt_weekends"))
View(user)
user = read.csv("./原数据-20210301-20210328/users.txt", sep = '\t', header=T)
View(user)
user = read.csv("./原数据-20210301-20210328/users.txt", sep = '\t', header=T, encoding = 'UTF-8')
View(user)
poi = read.csv("./原数据-20210301-20210328/poi.txt", sep = '\t', header=T, encoding = 'UTF-8')
poi = read.csv("./原数据-20210301-20210328/pois.txt", sep = '\t', header=T, encoding = 'UTF-8')
View(poi)
table(poi$primary_first_tag_name)
table(poi$primary_second_tag_name)
table(poi$primary_third_tag_name)
table(poi$poi_brand_id)
poi$primary_second_tag_name = str_replace_all(poi$primary_second_tag_name, " ", "")
poi$primary_first_tag_name = str_replace_all(poi$primary_first_tag_name, " ", "")
poi$primary_third_tag_name = str_replace_all(poi$primary_third_tag_name, " ", "")
table(poi$primary_first_tag_name)
table(poi$primary_third_tag_name)
poi$primary_third_tag_name = str_replace_all(poi$primary_third_tag_name, "\t", "")
table(poi$primary_third_tag_name)
as.character(as.numeric(poi$primary_third_tag_name)) %>% table()
order_poi = read.csv("./原数据-20210301-20210328/orders_poi_session.txt",
sep = '\t', header=T, encoding = 'UTF-8')
View(order_poi)
order_poi[1,] %>% class()
rbind(order_poi[1,], data.frame(0))
rbind(order_poi[1,], data.frame(3))
ncol(data.frame(0))
options(stringsAsFactors = F)
data.frame(0, row.names = rownames(order_poi))
View(data.frame(0))
str_split('NULL', "#")
str_split('2975#2219#2219#1896
', "#")
data.frame(list(0,"0",0))
colnames(order_poi)
return(df)
longer = function(r){
t = unlist(str_split(r$clicks))
t = unique(t)
df = data.frame(wm_order_id = r$wm_order_id,
click_poi = t,
dt = dt)
df$click_poi = as.numeric(df$click_poi)
return(df)
}
longer(order_poi[1,])
longer = function(r){
t = unlist(str_split(r$clicks, "#"))
t = unique(t)
df = data.frame(wm_order_id = r$wm_order_id,
click_poi = t,
dt = dt)
df$click_poi = as.numeric(df$click_poi)
return(df)
}
longer(order_poi[1,])
longer = function(r){
t = unlist(str_split(r$clicks, "#"))
t = unique(t)
df = data.frame(wm_order_id = r$wm_order_id,
click_poi = t,
dt = r$dt)
df$click_poi = as.numeric(df$click_poi)
return(df)
}
longer(order_poi[1,])
longer(order_poi[3,])
apply(order_poi[1:10,], 1, longer)
longer = function(r){
r = as.data.frame(r, row.names = rownames(order_poi))
t = unlist(str_split(r$clicks, "#"))
t = unique(t)
df = data.frame(wm_order_id = r$wm_order_id,
click_poi = t,
dt = r$dt)
df$click_poi = as.numeric(df$click_poi)
return(df)
}
longer(order_poi[3,])
longer = function(r){
r = as.data.frame(r, col.names = colnames(order_poi))
t = unlist(str_split(r$clicks, "#"))
t = unique(t)
df = data.frame(wm_order_id = r$wm_order_id,
click_poi = t,
dt = r$dt)
df$click_poi = as.numeric(df$click_poi)
return(df)
}
longer(order_poi[3,])
apply(order_poi[1:10,], 1, longer)
as.vector(order_poi[1,])
longer = function(r){
r = as.vector(r)
t = unlist(str_split(r[2], "#"))
t = unique(t)
df = data.frame(wm_order_id = r[1],
click_poi = t,
dt = r[3])
df$click_poi = as.numeric(df$click_poi)
return(df)
}
longer(order_poi[3,])
longer(order_poi[1,])
apply(order_poi[1:10,], 1, longer)
apply(order_poi[1:10,], 1, longer) %>%
do.call(rbind(.))
apply(order_poi[1:10,], 1, longer) %>%
do.call(rbind())
apply(order_poi[1:10,], 1, longer) %>%
do.call(.,rbind())
apply(order_poi[1:10,], 1, longer) %>%
do.call(rbind(),.)
apply(order_poi[1:10,], 1, longer) %>%
do.call(rbind,.)
clicks = apply(order_poi, 1, longer) %>%
do.call(rbind,.)
View(clicks)
clicks = na.omit(clicks)
write.csv(clicks, "./dat/clicks.csv", fileEncoding = "UTF-8", row.names = F)
clicks = cbind(clicks, type = "click")
View(clicks)
write.csv(clicks, "./dat/clicks.csv", fileEncoding = "UTF-8", row.names = F)
library(tidyverse)
View(user)
user = read.csv("./原数据-20210301-20210328/users.txt", sep = '\t', header=T, encoding = 'UTF-8')
poi = read.csv("./原数据-20210301-20210328/pois.txt", sep = '\t', header=T, encoding = 'UTF-8')
order_poi = read.csv("./原数据-20210301-20210328/orders_poi_session.txt",
sep = '\t', header=T, encoding = 'UTF-8')
order_train = read.csv("./原数据-20210301-20210328/orders_train.txt",
sep = '\t', header=T, encoding = 'UTF-8')
order_test = read.csv("./原数据-20210301-20210328/orders_test_poi.txt",
sep = '\t', header=T, encoding = 'UTF-8')
order_test_label = read.csv("./原数据-label-20210301-20210328//",
sep = '\t', header=T, encoding = 'UTF-8')
order_test_label = read.csv("./原数据-label-20210301-20210328/orders_poi_test_label.txt",
sep = '\t', header=T, encoding = 'UTF-8')
user_idx = sample(user$user_id)
user_idx = sample(user$user_id, prob = 0.10)
user_idx = sample(user$user_id, size = 20000)
user2 = user %>%
filter(user_id %in% user_idx)
View(poi)
order_train2 = order_train %>%
filter(user_id %in% user_idx)
order_test2 = order_test %>%
filter(user_id %in% user_idx)
order_test_label2 = order_test_label %>%
filter(user_id %in% user_idx)
order_poi2 = order_poi %>%
filter(wm_order_id %in% unique(order_train2$wm_order_id))
poi2 = poi %>%
filter(poi %in% unique(order_train2$wm_poi_id))
poi2 = poi %>%
filter(wm_poi_id %in% unique(order_train2$wm_poi_id))
write.csv(user2, "/dat/user_sampling.csv", fileEncoding = "UTF-8", row.names = F)
write.csv(user2, file = "/dat/user_sampling.csv", fileEncoding = "UTF-8", row.names = F)
write.csv(user2, file = "./dat/user_sampling.csv", fileEncoding = "UTF-8", row.names = F)
write.csv(order_train2, file = "./dat/order_train_sampling.csv", fileEncoding = "UTF-8", row.names = F)
write.csv(order_test2, file = "./dat/order_test_sampling.csv", fileEncoding = "UTF-8", row.names = F)
write.csv(order_poi2, file = "./dat/orders_poi_session_sampling.csv", fileEncoding = "UTF-8", row.names = F)
write.csv(poi2, file = "./dat/poi_sampling.csv", fileEncoding = "UTF-8", row.names = F)
order_poi = read.csv("./dat/orders_poi_session_sampling.csv",
sep = '\t', header=T, encoding = 'UTF-8')
longer = function(r){
r = as.vector(r)
t = unlist(str_split(r[2], "#"))
t = unique(t)
df = data.frame(wm_order_id = r[1],
click_poi = t,
dt = r[3])
df$click_poi = as.numeric(df$click_poi)
return(df)
}
longer(order_poi[1,])
View(order_poi)
order_poi = read.csv("./dat/orders_poi_session_sampling.csv",
header=T, encoding = 'UTF-8')
View(order_poi)
longer = function(r){
r = as.vector(r)
t = unlist(str_split(r[2], "#"))
t = unique(t)
df = data.frame(wm_order_id = r[1],
click_poi = t,
dt = r[3])
df$click_poi = as.numeric(df$click_poi)
return(df)
}
longer(order_poi[1,])
clicks = apply(order_poi, 1, longer) %>%
do.call(rbind,.)
View(clicks)
clicks = na.omit(clicks)
order_train = read.csv("./dat/order_train_sampling.csv",  header=T, encoding = 'UTF-8')
colnames(order_train)
clicks %>%
left_join(select(order_train, wm_order_id, user_id))
View(clicks)
View(order_poi)
View(clicks)
longer = function(r){
r = as.vector(r)
t = unlist(str_split(r[2], "#"))
t = unique(t)
df = data.frame(wm_order_id = r[1],
click_poi = t,
dt = r[3])
df = apply(df, 2, as.numeric)
return(df)
}
longer(order_poi[1,])
clicks = apply(order_poi, 1, longer) %>%
do.call(rbind,.)
clicks = na.omit(clicks)
clicks %>%
left_join(select(order_train, wm_order_id, user_id))
clicks = as.data.frame(clicks)
clicks %>%
left_join(select(order_train, wm_order_id, user_id))
clicks = clicks %>%
left_join(select(order_train, wm_order_id, user_id)) %>%
select(user_id, wm_poi_id = click_poi, dt) %>%
mutate(type = "click")
View(clicks)
write.csv(clicks, "./dat/clicks.csv", fileEncoding = "UTF-8", row.names = F)
